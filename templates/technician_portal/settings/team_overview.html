{% extends 'base.html' %}
{% load static %}

{% block title %}Team Overview{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/components/manager-settings.css' %}">
{% endblock %}

{% block content %}
<div class="settings-container">
    <!-- Header -->
    <div class="settings-header">
        <div class="header-content">
            <div class="header-icon">
                <i class="fas fa-users"></i>
            </div>
            <div>
                <h1 class="settings-title">Team Overview</h1>
                <p class="settings-subtitle">Performance and stats for managed technicians</p>
            </div>
        </div>
    </div>

    <!-- Team Summary Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);">
                <i class="fas fa-user-group"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ team_members_count }}</div>
                <div class="stat-label">Team Members</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">
                <i class="fas fa-wrench"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ total_team_repairs }}</div>
                <div class="stat-label">Total Repairs</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ total_team_pending }}</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%);">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value">{{ total_team_completed }}</div>
                <div class="stat-label">Completed</div>
            </div>
        </div>
    </div>

    <!-- Team Members -->
    <div class="team-members-section">
        <h2 class="section-heading">
            <i class="fas fa-users"></i>
            Team Members
        </h2>

        {% if team_stats %}
        <div class="team-members-grid">
            {% for member in team_stats %}
            <div class="team-member-card">
                <div class="member-header">
                    <div class="member-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="member-info">
                        <h3 class="member-name">{{ member.technician.user.get_full_name|default:member.technician.user.username }}</h3>
                        <p class="member-email">{{ member.technician.user.email }}</p>
                        <p class="member-phone">
                            <i class="fas fa-phone"></i>
                            {{ member.technician.phone_number|default:"N/A" }}
                        </p>
                    </div>
                </div>

                <div class="member-stats">
                    <div class="member-stat">
                        <span class="stat-number">{{ member.total_repairs }}</span>
                        <span class="stat-description">Total Repairs</span>
                    </div>
                    <div class="member-stat">
                        <span class="stat-number">{{ member.pending_repairs }}</span>
                        <span class="stat-description">Pending</span>
                    </div>
                    <div class="member-stat">
                        <span class="stat-number">{{ member.completed_repairs }}</span>
                        <span class="stat-description">Completed</span>
                    </div>
                    <div class="member-stat">
                        <span class="stat-number">{{ member.completion_rate }}%</span>
                        <span class="stat-description">Rate</span>
                    </div>
                </div>

                <div class="member-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ member.completion_rate }}%;"></div>
                    </div>
                </div>

                <!-- Recent Repairs -->
                {% if member.recent_repairs %}
                <div class="member-recent-repairs">
                    <h4 class="recent-title">
                        <i class="fas fa-clock"></i>
                        Recent Repairs
                    </h4>
                    <div class="recent-repairs-list">
                        {% for repair in member.recent_repairs %}
                        <a href="{% url 'repair_detail' repair.id %}" class="recent-repair-item">
                            <div class="repair-info">
                                <span class="repair-unit">{{ repair.unit_number }}</span>
                                <span class="repair-customer">{{ repair.customer.name }}</span>
                            </div>
                            <span class="repair-status status-{{ repair.queue_status|lower }}">
                                {{ repair.get_queue_status_display }}
                            </span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-user-slash"></i>
            <h3>No Team Members</h3>
            <p>You don't have any technicians assigned to your team yet.</p>
        </div>
        {% endif %}
    </div>

    <!-- Back Button -->
    <div class="settings-actions">
        <a href="{% url 'manager_settings_dashboard' %}" class="btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Back to Settings
        </a>
    </div>
</div>
{% endblock %}
